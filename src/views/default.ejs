<%

// Total amount of images on the page.
var total = 0;

// We generate the galleries right away because we want to use the first image for Facebook.
if (page.gallery) {
    total += page.gallery.length;
    var gallery = page.renderGalleryImages(page);
}

if (page.screenshots) {
    total += page.screenshots.length;
    var screenshots = page.renderGalleryImages(page, 'screenshots');
}

%>
<% include partials/head %>
<div class="container">
    <div class="text<% if (page.year && page.year > new Date().getFullYear()) { %> abs-before-after project-wip<% } %>">
        <h1 class="text-title"><%= page.title %></h1>
        <% if (page.description || page.programs || page.work) { %>
                <% if (page.description) { %>
                    <p class="text-subtitle"><%= page.description %></p>
                <% } %>
            <div class="text-meta">
                <% if (page.programs) { %>
                    <p class="text-programs"><%- page.renderProgramIcons(page.programs, true) %></p>
                <% } %>
                <% if (page.work) { %>
                    <ul class="text-work"><li><%- page.work.join("</li><li>") %></li></ul>
                <% } %>
            </div>
        <% } %>
        <div class="text-content">
            <%- contents %>
        </div>
        <% if (page.next || page.previous) { %>
            <div class="pager-top pager-wrapper"><% include partials/pager %></div>
        <% } %>
    </div>
    <% if (page.gallery || page.screenshots || page.vimeo) { %>
        <div id="gallery">
            <% if (page.gallery) { %>
                <section class="media">
                    <h2 class="media-title sr-only">Gallery</h2>
                    <div class="clearfix media-content"><%- gallery %></div>
                </section>
            <% } %>
            <% if (page.screenshots) { %>
                <section class="media">
                    <h2 class="media-title">Screenshots</h2>
                    <div class="clearfix media-content"><%- screenshots %></div>
                </section>
            <% } %>
            <% if (page.vimeo) { %>
                <section class="media">
                    <h2 class="media-title">Videos</h2>
                    <div class="clearfix media-content">
                        <% page.vimeo.forEach(function (id) { %>
                            <div class="media-element media-video">
                                <noscript>
                                    <iframe src="//player.vimeo.com/video/<%= id %>" height="337.5" webkitallowfullscreen mozallowfullscreen allowfullscreen width="600"></iframe>
                                </noscript>
                                <iframe data-src="//player.vimeo.com/video/<%= id %>" height="337.5" webkitallowfullscreen mozallowfullscreen allowfullscreen width="600"></iframe>
                            </div>
                        <% }); %>
                    </div>
                </section>
            <% } %>
        </div>
        <% if (page.next || page.previous) { %>
            <div class="pager-bottom pager-wrapper"><% include partials/pager %></div>
        <% } %>
    <% } %>
</div>
<% if (page.gallery || page.screenshots) { %>
    <div id="full-screen" class="abs-before sr-only">
        <nav class="full-screen-nav">
            <% if (total > 1) { %>
                <a id="full-screen-previous" class="full-screen-pager" href="#" title="Go to the previous image."><span aria-hidden="true" role="presentation">◀</span></a>
                <b class="full-screen-position">
                    <span id="full-screen-current"></span>
                    /
                    <span id="full-screen-total"><%= total %></span>
                </b>
                <a id="full-screen-next" class="full-screen-pager" href="#" title="Go to the next image."><span aria-hidden="true" role="presentation">▶</span></a>
            <% } %>
            <a id="full-screen-close" href="#" title="Exit full-screen mode."><span aria-hidden="true" role="presentation">✖</span></a>
        </nav>
    </div>
<% } %>
<% include partials/foot %>
